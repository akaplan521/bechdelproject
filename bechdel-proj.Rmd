---
title: "Bechdel Project Draft"
output: html_document
date: "2024-03-07"
authors: "Alexa Kaplan, Alec Beland, Catherine Crowell, Carolyn Kelly"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      fig.align = "center",
                      message = F,
                      warning = F)

#load packages we will need
install.packages("dplyr", repos = "http://cran.us.r-project.org")
pacman::p_load(tidyverse, skimr, rpart, class, caret, rpart.plot)

#we can also change default themes here if necessary

#read in the data file here!!!

bechdel <- read_csv("bechdel2.csv")

```

## I. Introduction


The Bechdel Test assesses female representation in film. To pass, the film must show two women who talk to each other about something other than men. The data we are working with is the "Movies Bechdel Test" data set from the miscellaneous data sets provided on Brightspace. It contains data on 1,793 films ranging from the years 1970 to 2013, including their 

1. **imdbId**: IMDB id number
2. **year**: Year released
3. **Decade**: Decade released 
4. **title.y**: Title of the film
5. **Btest**: Result of the bechdel test:
6. **Btest5**: on a scale of 1 to 5: A score of 1 passes the test; a score of 2 is "dubious" as it is unclear whether the dialogue between the two women is sufficient to pass; a film with a 3 includes women who talk to each other exclusively about men; a 4 has women who do not talk to each other; and, finally, a 5 has no female characters.
7. **budget13**: The film's budget
8. **domgross13**: Domestic grossing
9. **intgross13**: International grossing
10. **domprofit13**: Domestic profit
11. **intprofit13**: International Profit
12. **averating**: The average rating of the film
13. **nrating**: The number of ratings considered in **averating**

There is a potential for sampling bias in our data set, because the movies were selected if they were on the BechdelTest.com website which details 5,000 films as well as in The-Numbers.com website which includes financial data on films. The need to eliminate films that do not overlap on these two websites could lead to selection bias. Nevertheless, our sample amounts to 1,793 films out of Hollywood in the time frame of four decades which is not insignificant, and the larger the sample, the lower the bias. There should be no issue with recall or confirmation bias in our data since all measurements from profits and budget are quantitative, not qualitative, as well as the Bechdel Test itself which turns objective criteria into a numeric score.

This data is of interest because, while we like to think that gender equality and gender roles have drastically improved in the past five decades (range of this data set), we can look at the variable of female representation in film to check social progress as it has translated to Hollywood. It will be interesting to visualize how the the finances of films which pass the Bechdel test, a "bare minimum" of fair female representation, compare with the rest of the films. 

As for data cleaning, data points with missing values were removed so that results would not be skewed. 

## Data Cleaning


```{r question 1 - Introduction}
#data cleaning here described above...
bechdel_factored <- bechdel |> 
  mutate(score = case_when(Btest5 == "1 ok" ~ 1,
                           Btest5 == "2 dubious" ~ 2,
                           Btest5 == "3 men" ~ 3,
                           Btest5 == "4 notalk" ~ 4,
                           Btest5 == "5 nowomen" ~ 5)) |> 
  select(-Btest5)
  
```

## II. Data Visualizations:


```{r question 2 - Data Visualizations (boxplot)}
# line to rating by score 
bechdByRating <-
  ggplot(
    data = bechdel_factored,
    mapping = aes(
      x = averating,
      y = fct_rev(factor(score)),
      fill = factor(score)
    )
  ) +
  
  geom_boxplot() +
  
  scale_fill_manual(values=c('#81ff6e', '#ecff96', '#ffe896', '#faaf7d', '#fa3e3e')) +
  
  theme_classic() +
  
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.4)) +
  
  labs(
    x = "Average Rating (Out of 5 Stars)",
    y = "Bechdel Score (1 = Pass)",
    title = "Bechdel Score VS Average Rating"
  ) 

# show graph
bechdByRating


```

In this first data visualization, the average rating out of five of a given film is on the x-axis and the Bechdel score it received is on the y-axis. The highest concentrations of films have a rating of between 3 and 4 and a bechdel score of either 1 or 4. 

```{r question 2 - Data Visualizations (barplot)}

#barplot to show scores by number of films

bechdBar <- ggplot(
    data = bechdel_factored,
    mapping = aes(x = fct_rev(factor(score)))
  ) +
  geom_bar(aes(fill = factor(score))) +
  scale_fill_manual(values = c('#81ff6e', '#ecff96', '#ffe896', '#faaf7d', '#fa3e3e')) +
  scale_y_continuous(expand = c(0, 0, 0.05, 0), 
                     labels = scales::label_percent()) +
  labs(x = "Bechdel Score", 
       y = "Number of Films",
       title = "Number of Films by Bechdel Rating") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.4))

# Show graph
bechdBar

```

This bar chart shows the total count of films with each unique Bechdel test score in our data set. The highest proportion of movies have a score of one, passing the Bechdel test, with the next highest score being a 4, indicating that females are in the movie but do not speak. If added up, the count of Bechdel scores between 2-5 (do not pass) still outnumber the quantity of films that do pass the test. 

```{r question 2 - Data Visualizations (scatter)}
# scatter to show rating by score with lines
bechdScatter <- ggplot(
  data = bechdel_factored,
  mapping = aes(
    x = averating,
    y = budget13,
    color = factor(score)
  )
) +
  
  geom_point() +
  
  geom_smooth(
    method = loess,
    formula = y~x,
    se = F
  ) +
  
  labs(
    x = "Average Rating",
    y = "Budget",
    title = "Correlation of Budget with Average Rating",
    color = "Score"
  ) +
  
  theme_classic()

# show graph
bechdScatter

```

Each point on this scatterplot is positioned by its average rating on the x-axis and the budget of the film on the y-axis. The color of each point, indicated in the key, represents a different Bechdel score rating, with a trend line for each to show the pattern of how its rating and budget relate. 

```{r question 2 - Data Visualizations (side-by-side bar)}
# side-by-side bars to show domestic vs international profit
## code here

```

This graph will compare how films of each of the Bechdel test scores fared in international and domestic profit. This will indicate if there was any difference is international success that could be due to female representation or lack thereof. 

```{r question 2 - Data Visualizations (stacked bar)}
# compare bechdel ratings by decade
bechdel_factored$Decade <- as.factor(bechdel_factored$Decade)
bechdel_factored$score <- as.factor(bechdel_factored$score)

bech_by_decade <- ggplot(bechdel_factored,
                         mapping = aes(x = Decade,
                         fill = score))    +
    
  geom_bar(position = "fill")    +
  # Adding a title, removing the labels for y and fill
  labs(x = "Decade", 
       y = "Percentage of Films", 
       fill = "Bechdel Score", 
       title = "Bechdel Ratings For Different Decades")    +
  # Changing the tickmarks to percentages and removing the buffer space
  scale_y_continuous(expand = c(0, 0, 0.05, 0), 
                     labels = scales::label_percent())    +
  scale_fill_manual(values=c('#81ff6e', '#ecff96', '#ffe896', '#faaf7d', '#fa3e3e')) +

  # Changing the theme to theme_classic()
  theme_classic() +
  # Centering the title
  theme(plot.title = element_text(hjust = 0.8))

# show graph
bech_by_decade
```

This stacked bar chart segments the films in our data by decade on the x-axis and the the data within each bar shows the percentage of films in our data set that accounted for each score 1-5 of the Bechdel test. Passing scores appear to increase as the decades pass which is a positive sign, although it is consistent that the majority of films throughout each of the five decades do not pass this simple test. 

## III: Machine Learning Methods

#kNN Classification
```{r}
# Set up functions for data modification

# Normalize function:
normalize <- function(x) {
  norm_x <- (x - min(x)) / (max(x) - min(x))
  return(norm_x)
}

# Standardize function:
standardize <- function(x) {
  standard_x <- (x - mean(x))/(sd(x))
  return(standard_x)
}

# Modify the data 

# Normalize the data
bech_norm <-
  bechdel |> 
  select(-imdbId, -Decade, -title.y, -Btest5, -domprofit13, -intprofit13) |> 
  mutate(
    across(
      .cols = -Btest,
      .fns = normalize
    )
  )

# Standardizing the data
bech_stan <-
  bechdel |>  
  select(-imdbId, -Decade, -title.y, -Btest5, -domprofit13, -intprofit13) |> 
  mutate(
    across(
      .cols = -Btest,
      .fns = standardize
    )
  )

# Check the data

# Check that normalization worked for 3 variables:
bech_norm |> 
  # Changing from wide to long format
  pivot_longer(
    cols = -Btest,
    names_to = "feature"
  ) |> 
  # calculating the mean, sd, min, and max for each feature
  summarize(
    .by = feature,
    average = mean(value) |> round(digits = 2),
    standard_deviation = sd(value) |> round(digits = 2),
    p0 = min(value) |> round(digits = 2),
    p100 = max(value) |> round(digits = 2)
  )

# Check that standardization worked for 3 variables:
bech_stan |> 
  # Changing from wide to long format
  pivot_longer(
    cols = -Btest,
    names_to = "feature"
  ) |> 
  # calculating the mean, sd, min, and max for each feature
  summarize(
    .by = feature,
    average = mean(value) |> round(digits = 2),
    standard_deviation = sd(value) |> round(digits = 2),
    p0 = min(value) |> round(digits = 2),
    p100 = max(value) |> round(digits = 2)
  )
```